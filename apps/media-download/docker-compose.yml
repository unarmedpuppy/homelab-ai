version: "3.8"

services:
  # VPN Gateway with Kill Switch - Gluetun with ProtonVPN
  gluetun:
    # image: qmcgaw/gluetun:latest
    image: harbor.server.unarmedpuppy.com/docker-hub/qmcgaw/gluetun:latest
    container_name: media-download-gluetun
    cap_add:
      - NET_ADMIN
    devices:
      - /dev/net/tun:/dev/net/tun
    environment:
      - VPN_SERVICE_PROVIDER=custom
      - OPENVPN_CUSTOM_CONFIG=/openvpn/client.ovpn
      - KILL_SWITCH=on
      - KILL_SWITCH_ACTIVATE=on
      - TZ=${TZ:-America/Chicago}
      # DNS Configuration - Use plain DNS (UDP) instead of DoT for better reliability
      # All DNS queries still go through VPN, maintaining privacy and preventing leaks
      # DNS_ADDRESS accepts only a single IP address (use first DNS server)
      - DNS_ADDRESS=1.1.1.1
      - DOT=off
      # Unblock specific domains that may be flagged by malicious DNS blocking
      # DNS queries still encrypted through VPN - no DNS/IP leaks possible
      - UNBLOCK=news.usenetserver.com,news-us.usenetserver.com,news-eu.usenetserver.com
      # HTTP Proxy for other services to route through VPN
      - HTTPPROXY=on
    volumes:
      - ./gluetun:/gluetun
      - ./openvpn:/openvpn
    networks:
      - media-download-network
      - my-network  # Allow polymarket-bot to reach the HTTP proxy
    ports:
      - "8880:8080"  # qBittorrent web UI (routed through VPN)
      - "6789:6789"  # NZBGet web UI (routed through VPN)
      - "5030:5030"  # slskd web UI and API (routed through VPN)
      # HTTP Proxy on port 8888 is accessible internally via Docker network (no host mapping needed)
    restart: unless-stopped

  # Usenet Indexer & Aggregator
  nzbhydra2:
    # image: lscr.io/linuxserver/nzbhydra2:latest
    image: harbor.server.unarmedpuppy.com/lscr/linuxserver/nzbhydra2:latest
    container_name: media-download-nzbhydra2
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=${TZ:-America/Chicago}
      - SEARCHER=legacy
      - DAEMON_LOGLEVEL=WARN
      - WEB_LOGFILE=true
    volumes:
      - ./nzbhydra2/config:/config
      - ./nzbhydra2/data:/data
    ports:
      - "5076:5076"
    restart: unless-stopped
    networks:
      - media-download-network
      - my-network
    labels:
      - "traefik.enable=true"
      - "traefik.docker.network=my-network"
      # HTTPS redirect
      - "traefik.http.middlewares.nzbhydra2-redirect.redirectscheme.scheme=https"
      - "traefik.http.routers.nzbhydra2-redirect.middlewares=nzbhydra2-redirect"
      - "traefik.http.routers.nzbhydra2-redirect.rule=Host(`nzbhydra2.server.unarmedpuppy.com`)"
      - "traefik.http.routers.nzbhydra2-redirect.entrypoints=web"
      # Local network access (no auth) - highest priority
      - "traefik.http.routers.nzbhydra2-local.rule=Host(`nzbhydra2.server.unarmedpuppy.com`) && ClientIP(`192.168.86.0/24`)"
      - "traefik.http.routers.nzbhydra2-local.priority=100"
      - "traefik.http.routers.nzbhydra2-local.entrypoints=websecure"
      - "traefik.http.routers.nzbhydra2-local.tls.certresolver=myresolver"
      # External access (requires auth) - lowest priority
      - "traefik.http.routers.nzbhydra2.rule=Host(`nzbhydra2.server.unarmedpuppy.com`)"
      - "traefik.http.routers.nzbhydra2.priority=1"
      - "traefik.http.routers.nzbhydra2.entrypoints=websecure"
      - "traefik.http.routers.nzbhydra2.tls.certresolver=myresolver"
      - "traefik.http.routers.nzbhydra2.tls=true"
      - "traefik.http.routers.nzbhydra2.middlewares=nzbhydra2-auth"
      # Service and auth middleware
      - "traefik.http.services.nzbhydra2.loadbalancer.server.port=5076"
      - "traefik.http.middlewares.nzbhydra2-auth.basicauth.users=unarmedpuppy:$$apr1$$yE.A6vVX$$p7.fpGKw5Unp0UW6H/2c.0"
      - "traefik.http.middlewares.nzbhydra2-auth.basicauth.realm=NZBHydra2"
      # Homepage labels
      - "homepage.group=Media & Entertainment"
      - "homepage.name=NZBHydra2"
      - "homepage.href=https://nzbhydra2.server.unarmedpuppy.com"
      - "homepage.icon=si-searxng"
      - "homepage.description=Usenet meta search aggregator"
    # NOT on VPN - only searches, doesn't download

  # Torrent Indexer
  jackett:
    # image: lscr.io/linuxserver/jackett:latest
    image: harbor.server.unarmedpuppy.com/lscr/linuxserver/jackett:latest
    container_name: media-download-jackett
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=${TZ:-America/Chicago}
    volumes:
      - ./jackett/config:/config
    ports:
      - "9117:9117"
    restart: unless-stopped
    networks:
      - media-download-network
      - my-network
    labels:
      - "traefik.enable=true"
      - "traefik.docker.network=my-network"
      # HTTPS redirect
      - "traefik.http.middlewares.jackett-redirect.redirectscheme.scheme=https"
      - "traefik.http.routers.jackett-redirect.middlewares=jackett-redirect"
      - "traefik.http.routers.jackett-redirect.rule=Host(`jackett.server.unarmedpuppy.com`)"
      - "traefik.http.routers.jackett-redirect.entrypoints=web"
      # Local network access (no auth) - highest priority
      - "traefik.http.routers.jackett-local.rule=Host(`jackett.server.unarmedpuppy.com`) && ClientIP(`192.168.86.0/24`)"
      - "traefik.http.routers.jackett-local.priority=100"
      - "traefik.http.routers.jackett-local.entrypoints=websecure"
      - "traefik.http.routers.jackett-local.tls.certresolver=myresolver"
      # External access (requires auth) - lowest priority
      - "traefik.http.routers.jackett.rule=Host(`jackett.server.unarmedpuppy.com`)"
      - "traefik.http.routers.jackett.priority=1"
      - "traefik.http.routers.jackett.entrypoints=websecure"
      - "traefik.http.routers.jackett.tls.certresolver=myresolver"
      - "traefik.http.routers.jackett.tls=true"
      - "traefik.http.routers.jackett.middlewares=jackett-auth"
      # Service and auth middleware
      - "traefik.http.services.jackett.loadbalancer.server.port=9117"
      - "traefik.http.middlewares.jackett-auth.basicauth.users=unarmedpuppy:$$apr1$$yE.A6vVX$$p7.fpGKw5Unp0UW6H/2c.0"
      - "traefik.http.middlewares.jackett-auth.basicauth.realm=Jackett"
      # Homepage labels
      - "homepage.group=Media & Entertainment"
      - "homepage.name=Jackett"
      - "homepage.href=https://jackett.server.unarmedpuppy.com"
      - "homepage.icon=si-searxng"
      - "homepage.description=Torrent indexer proxy"
    # NOT on VPN - only searches, doesn't download

  # Unified Indexer Manager (Better alternative to NZBHydra2 + Jackett)
  prowlarr:
    # image: lscr.io/linuxserver/prowlarr:latest
    image: harbor.server.unarmedpuppy.com/lscr/linuxserver/prowlarr:latest
    container_name: media-download-prowlarr
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=${TZ:-America/Chicago}
    volumes:
      - ./prowlarr/config:/config
    ports:
      - "9696:9696"
    restart: unless-stopped
    networks:
      - media-download-network
      - my-network
    labels:
      - "traefik.enable=true"
      - "traefik.docker.network=my-network"
      # HTTPS redirect
      - "traefik.http.middlewares.prowlarr-redirect.redirectscheme.scheme=https"
      - "traefik.http.routers.prowlarr-redirect.middlewares=prowlarr-redirect"
      - "traefik.http.routers.prowlarr-redirect.rule=Host(`prowlarr.server.unarmedpuppy.com`)"
      - "traefik.http.routers.prowlarr-redirect.entrypoints=web"
      # Local network access (no auth) - highest priority
      - "traefik.http.routers.prowlarr-local.rule=Host(`prowlarr.server.unarmedpuppy.com`) && ClientIP(`192.168.86.0/24`)"
      - "traefik.http.routers.prowlarr-local.priority=100"
      - "traefik.http.routers.prowlarr-local.entrypoints=websecure"
      - "traefik.http.routers.prowlarr-local.tls.certresolver=myresolver"
      # External access (requires auth) - lowest priority
      - "traefik.http.routers.prowlarr.rule=Host(`prowlarr.server.unarmedpuppy.com`)"
      - "traefik.http.routers.prowlarr.priority=1"
      - "traefik.http.routers.prowlarr.entrypoints=websecure"
      - "traefik.http.routers.prowlarr.tls.certresolver=myresolver"
      - "traefik.http.routers.prowlarr.tls=true"
      - "traefik.http.routers.prowlarr.middlewares=prowlarr-auth"
      # Service and auth middleware
      - "traefik.http.services.prowlarr.loadbalancer.server.port=9696"
      - "traefik.http.middlewares.prowlarr-auth.basicauth.users=unarmedpuppy:$$apr1$$yE.A6vVX$$p7.fpGKw5Unp0UW6H/2c.0"
      - "traefik.http.middlewares.prowlarr-auth.basicauth.realm=Prowlarr"
      # Homepage labels
      - "homepage.group=Media & Entertainment"
      - "homepage.name=Prowlarr"
      - "homepage.href=https://prowlarr.server.unarmedpuppy.com"
      - "homepage.icon=si-prettier"
      - "homepage.description=Unified indexer manager for *arr apps"
    # NOT on VPN - only searches, doesn't download

  # Usenet Download Client
  nzbget:
    # image: lscr.io/linuxserver/nzbget:latest
    image: harbor.server.unarmedpuppy.com/lscr/linuxserver/nzbget:latest
    container_name: media-download-nzbget
    logging:
      driver: "json-file"
      options:
        max-size: "100m"
        max-file: "3"
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=${TZ:-America/Chicago}
    volumes:
      - ./nzbget/config:/config
      - /jenquist-cloud/archive/media-downloads-temp:/downloads
    network_mode: "service:gluetun"  # Kill switch: routes all traffic through VPN
    depends_on:
      gluetun:
        condition: service_healthy  # Wait for gluetun to be healthy before starting
    restart: unless-stopped

  # Torrent Download Client
  qbittorrent:
    # image: lscr.io/linuxserver/qbittorrent:latest
    image: harbor.server.unarmedpuppy.com/lscr/linuxserver/qbittorrent:latest
    container_name: media-download-qbittorrent
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=${TZ:-America/Chicago}
      - WEBUI_PORT=8080
    volumes:
      - ./qbittorrent/config:/config
      - /jenquist-cloud/archive/media-downloads-temp:/downloads
    network_mode: "service:gluetun"  # Kill switch: routes all traffic through VPN
    depends_on:
      gluetun:
        condition: service_healthy  # Wait for gluetun to be healthy before starting
    restart: unless-stopped
    # Note: qBittorrent is behind VPN and accessed by automation services only

  # Soulseek Daemon (slskd) - P2P Music Download Client
  # Note: If slskd/slskd:latest doesn't exist, you may need to:
  # 1. Build from source: https://github.com/slskd/slskd
  # 2. Use an alternative Docker image (check Docker Hub)
  # 3. Or run slskd on the host and connect via host IP
  slskd:
    # image: slskd/slskd:latest
    image: harbor.server.unarmedpuppy.com/docker-hub/slskd/slskd:latest
    container_name: media-download-slskd
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=${TZ:-America/Chicago}
    volumes:
      - ./slskd/config:/app/.config/slskd
      - /jenquist-cloud/archive/media-downloads-temp/soulseek:/downloads
      - /jenquist-cloud/archive/media-downloads-temp/soulseek/incomplete:/incomplete
      # Share directory - IMPORTANT: Must share files to avoid bans
      - ${MEDIA_PATH:-/jenquist-cloud/archive/entertainment-media}/Music:/shared
    network_mode: "service:gluetun"  # Kill switch: routes all traffic through VPN
    depends_on:
      gluetun:
        condition: service_healthy  # Wait for gluetun to be healthy before starting
    restart: unless-stopped
    # Note: slskd web UI accessible at http://192.168.86.47:5030 (routed through VPN)
    # All P2P traffic goes through VPN with DNS leak protection
    # Homepage labels added via gluetun port mapping - access via exposed port

  # TV Shows Automation
  sonarr:
    # image: lscr.io/linuxserver/sonarr:latest
    image: harbor.server.unarmedpuppy.com/lscr/linuxserver/sonarr:latest
    container_name: media-download-sonarr
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=${TZ:-America/Chicago}
    volumes:
      - ./sonarr/config:/config
      - ${MEDIA_PATH:-/jenquist-cloud/archive/entertainment-media/tv}:/tv
      - /jenquist-cloud/archive/media-downloads-temp:/downloads
    ports:
      - "8989:8989"
    restart: unless-stopped
    networks:
      - media-download-network
      - my-network
    labels:
      - "traefik.enable=true"
      - "traefik.docker.network=my-network"
      # HTTPS redirect
      - "traefik.http.middlewares.sonarr-redirect.redirectscheme.scheme=https"
      - "traefik.http.routers.sonarr-redirect.middlewares=sonarr-redirect"
      - "traefik.http.routers.sonarr-redirect.rule=Host(`sonarr.server.unarmedpuppy.com`)"
      - "traefik.http.routers.sonarr-redirect.entrypoints=web"
      # Local network access (no auth) - highest priority
      - "traefik.http.routers.sonarr-local.rule=Host(`sonarr.server.unarmedpuppy.com`) && ClientIP(`192.168.86.0/24`)"
      - "traefik.http.routers.sonarr-local.priority=100"
      - "traefik.http.routers.sonarr-local.entrypoints=websecure"
      - "traefik.http.routers.sonarr-local.tls.certresolver=myresolver"
      # External access (requires auth) - lowest priority
      - "traefik.http.routers.sonarr.rule=Host(`sonarr.server.unarmedpuppy.com`)"
      - "traefik.http.routers.sonarr.priority=1"
      - "traefik.http.routers.sonarr.entrypoints=websecure"
      - "traefik.http.routers.sonarr.tls.certresolver=myresolver"
      - "traefik.http.routers.sonarr.tls=true"
      - "traefik.http.routers.sonarr.middlewares=sonarr-auth"
      # Service and auth middleware
      - "traefik.http.services.sonarr.loadbalancer.server.port=8989"
      - "traefik.http.middlewares.sonarr-auth.basicauth.users=unarmedpuppy:$$apr1$$yE.A6vVX$$p7.fpGKw5Unp0UW6H/2c.0"
      - "traefik.http.middlewares.sonarr-auth.basicauth.realm=Sonarr"
      # Homepage labels
      - "homepage.group=Media & Entertainment"
      - "homepage.name=Sonarr"
      - "homepage.href=https://sonarr.server.unarmedpuppy.com"
      - "homepage.icon=si-sonarr"
      - "homepage.description=TV shows automation"
    depends_on:
      - nzbhydra2
      - jackett

  # Movies Automation
  radarr:
    # image: lscr.io/linuxserver/radarr:latest
    image: harbor.server.unarmedpuppy.com/lscr/linuxserver/radarr:latest
    container_name: media-download-radarr
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=${TZ:-America/Chicago}
    volumes:
      - ./radarr/config:/config
      - ${MEDIA_PATH:-/jenquist-cloud/archive/entertainment-media/movies}:/movies
      - /jenquist-cloud/archive/media-downloads-temp:/downloads
    ports:
      - "7878:7878"
    restart: unless-stopped
    networks:
      - media-download-network
      - my-network
    labels:
      - "traefik.enable=true"
      - "traefik.docker.network=my-network"
      # HTTPS redirect
      - "traefik.http.middlewares.radarr-redirect.redirectscheme.scheme=https"
      - "traefik.http.routers.radarr-redirect.middlewares=radarr-redirect"
      - "traefik.http.routers.radarr-redirect.rule=Host(`radarr.server.unarmedpuppy.com`)"
      - "traefik.http.routers.radarr-redirect.entrypoints=web"
      # Local network access (no auth) - highest priority
      - "traefik.http.routers.radarr-local.rule=Host(`radarr.server.unarmedpuppy.com`) && ClientIP(`192.168.86.0/24`)"
      - "traefik.http.routers.radarr-local.priority=100"
      - "traefik.http.routers.radarr-local.entrypoints=websecure"
      - "traefik.http.routers.radarr-local.tls.certresolver=myresolver"
      # External access (requires auth) - lowest priority
      - "traefik.http.routers.radarr.rule=Host(`radarr.server.unarmedpuppy.com`)"
      - "traefik.http.routers.radarr.priority=1"
      - "traefik.http.routers.radarr.entrypoints=websecure"
      - "traefik.http.routers.radarr.tls.certresolver=myresolver"
      - "traefik.http.routers.radarr.tls=true"
      - "traefik.http.routers.radarr.middlewares=radarr-auth"
      # Service and auth middleware
      - "traefik.http.services.radarr.loadbalancer.server.port=7878"
      - "traefik.http.middlewares.radarr-auth.basicauth.users=unarmedpuppy:$$apr1$$yE.A6vVX$$p7.fpGKw5Unp0UW6H/2c.0"
      - "traefik.http.middlewares.radarr-auth.basicauth.realm=Radarr"
      # Homepage labels
      - "homepage.group=Media & Entertainment"
      - "homepage.name=Radarr"
      - "homepage.href=https://radarr.server.unarmedpuppy.com"
      - "homepage.icon=si-radarr"
      - "homepage.description=Movies automation"
    depends_on:
      - nzbhydra2
      - jackett

  # Music Automation
  lidarr:
    # image: lscr.io/linuxserver/lidarr:latest
    image: harbor.server.unarmedpuppy.com/lscr/linuxserver/lidarr:latest
    container_name: media-download-lidarr
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=${TZ:-America/Chicago}
    volumes:
      - ./lidarr/config:/config
      - ${MEDIA_PATH:-/jenquist-cloud/archive/entertainment-media/Music}:/music
      - /jenquist-cloud/archive/media-downloads-temp:/downloads
    ports:
      - "8686:8686"
    restart: unless-stopped
    networks:
      - media-download-network
      - my-network
    labels:
      - "traefik.enable=true"
      - "traefik.docker.network=my-network"
      # HTTPS redirect
      - "traefik.http.middlewares.lidarr-redirect.redirectscheme.scheme=https"
      - "traefik.http.routers.lidarr-redirect.middlewares=lidarr-redirect"
      - "traefik.http.routers.lidarr-redirect.rule=Host(`lidarr.server.unarmedpuppy.com`)"
      - "traefik.http.routers.lidarr-redirect.entrypoints=web"
      # Local network access (no auth) - highest priority
      - "traefik.http.routers.lidarr-local.rule=Host(`lidarr.server.unarmedpuppy.com`) && ClientIP(`192.168.86.0/24`)"
      - "traefik.http.routers.lidarr-local.priority=100"
      - "traefik.http.routers.lidarr-local.entrypoints=websecure"
      - "traefik.http.routers.lidarr-local.tls.certresolver=myresolver"
      # External access (requires auth) - lowest priority
      - "traefik.http.routers.lidarr.rule=Host(`lidarr.server.unarmedpuppy.com`)"
      - "traefik.http.routers.lidarr.priority=1"
      - "traefik.http.routers.lidarr.entrypoints=websecure"
      - "traefik.http.routers.lidarr.tls.certresolver=myresolver"
      - "traefik.http.routers.lidarr.tls=true"
      - "traefik.http.routers.lidarr.middlewares=lidarr-auth"
      # Service and auth middleware
      - "traefik.http.services.lidarr.loadbalancer.server.port=8686"
      - "traefik.http.middlewares.lidarr-auth.basicauth.users=unarmedpuppy:$$apr1$$yE.A6vVX$$p7.fpGKw5Unp0UW6H/2c.0"
      - "traefik.http.middlewares.lidarr-auth.basicauth.realm=Lidarr"
      # Homepage labels
      - "homepage.group=Media & Entertainment"
      - "homepage.name=Lidarr"
      - "homepage.href=https://lidarr.server.unarmedpuppy.com"
      - "homepage.icon=si-lidarr"
      - "homepage.description=Music automation"
    depends_on:
      - nzbhydra2
      - jackett

  # Subtitle Downloader
  bazarr:
    # image: lscr.io/linuxserver/bazarr:latest
    image: harbor.server.unarmedpuppy.com/lscr/linuxserver/bazarr:latest
    container_name: media-download-bazarr
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=${TZ:-America/Chicago}
    volumes:
      - ./bazarr/config:/config
      - ${MEDIA_PATH:-/jenquist-cloud/archive/entertainment-media}:/media
    ports:
      - "6767:6767"
    restart: unless-stopped
    networks:
      - media-download-network
      - my-network
    labels:
      - "traefik.enable=true"
      - "traefik.docker.network=my-network"
      # HTTPS redirect
      - "traefik.http.middlewares.bazarr-redirect.redirectscheme.scheme=https"
      - "traefik.http.routers.bazarr-redirect.middlewares=bazarr-redirect"
      - "traefik.http.routers.bazarr-redirect.rule=Host(`bazarr.server.unarmedpuppy.com`)"
      - "traefik.http.routers.bazarr-redirect.entrypoints=web"
      # Local network access (no auth) - highest priority
      - "traefik.http.routers.bazarr-local.rule=Host(`bazarr.server.unarmedpuppy.com`) && ClientIP(`192.168.86.0/24`)"
      - "traefik.http.routers.bazarr-local.priority=100"
      - "traefik.http.routers.bazarr-local.entrypoints=websecure"
      - "traefik.http.routers.bazarr-local.tls.certresolver=myresolver"
      # External access (requires auth) - lowest priority
      - "traefik.http.routers.bazarr.rule=Host(`bazarr.server.unarmedpuppy.com`)"
      - "traefik.http.routers.bazarr.priority=1"
      - "traefik.http.routers.bazarr.entrypoints=websecure"
      - "traefik.http.routers.bazarr.tls.certresolver=myresolver"
      - "traefik.http.routers.bazarr.tls=true"
      - "traefik.http.routers.bazarr.middlewares=bazarr-auth"
      # Service and auth middleware
      - "traefik.http.services.bazarr.loadbalancer.server.port=6767"
      - "traefik.http.middlewares.bazarr-auth.basicauth.users=unarmedpuppy:$$apr1$$yE.A6vVX$$p7.fpGKw5Unp0UW6H/2c.0"
      - "traefik.http.middlewares.bazarr-auth.basicauth.realm=Bazarr"
      # Homepage labels
      - "homepage.group=Media & Entertainment"
      - "homepage.name=Bazarr"
      - "homepage.href=https://bazarr.server.unarmedpuppy.com"
      - "homepage.icon=si-vlcmediaplayer"
      - "homepage.description=Subtitle downloader"
    depends_on:
      - sonarr
      - radarr
      - lidarr

  # Media Request Management
  overseerr:
    # image: lscr.io/linuxserver/overseerr:latest
    image: harbor.server.unarmedpuppy.com/lscr/linuxserver/overseerr:latest
    container_name: media-download-overseerr
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=${TZ:-America/Chicago}
    volumes:
      - ./overseerr/config:/config
    ports:
      - "5055:5055"
    networks:
      - media-download-network
      - my-network
    restart: unless-stopped
    labels:
      - "traefik.enable=true"
      - "traefik.docker.network=my-network"
      # HTTPS redirect
      - "traefik.http.middlewares.overseerr-redirect.redirectscheme.scheme=https"
      - "traefik.http.routers.overseerr-redirect.middlewares=overseerr-redirect"
      - "traefik.http.routers.overseerr-redirect.rule=Host(`overseerr.server.unarmedpuppy.com`)"
      - "traefik.http.routers.overseerr-redirect.entrypoints=web"
      # Main router - no basic auth (Overseerr has built-in Plex OAuth)
      - "traefik.http.routers.overseerr.rule=Host(`overseerr.server.unarmedpuppy.com`)"
      - "traefik.http.routers.overseerr.entrypoints=websecure"
      - "traefik.http.routers.overseerr.tls.certresolver=myresolver"
      - "traefik.http.routers.overseerr.tls=true"
      # Service definition
      - "traefik.http.services.overseerr.loadbalancer.server.port=5055"
      # Homepage labels
      - "homepage.group=Media & Entertainment"
      - "homepage.name=Overseerr"
      - "homepage.href=https://overseerr.server.unarmedpuppy.com"
      - "homepage.icon=si-plex"
      - "homepage.description=Media request management"
    depends_on:
      - sonarr
      - radarr

  # Books Automation (LazyLibrarian - no Goodreads dependency)
  # LazyLibrarian works with Open Library and other metadata sources
  lazylibrarian:
    # image: lscr.io/linuxserver/lazylibrarian:latest
    image: harbor.server.unarmedpuppy.com/lscr/linuxserver/lazylibrarian:latest
    container_name: media-download-lazylibrarian
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=${TZ:-America/Chicago}
    volumes:
      - ./lazylibrarian/config:/config
      - ${MEDIA_PATH:-/jenquist-cloud/archive/entertainment-media}/books:/books
      - /jenquist-cloud/archive/media-downloads-temp:/downloads
    ports:
      - "8787:5299"
    restart: unless-stopped
    networks:
      - media-download-network
      - my-network
    depends_on:
      - nzbhydra2
      - jackett
    labels:
      - "traefik.enable=true"
      - "traefik.docker.network=my-network"
      # HTTPS redirect
      - "traefik.http.middlewares.lazylibrarian-redirect.redirectscheme.scheme=https"
      - "traefik.http.routers.lazylibrarian-redirect.middlewares=lazylibrarian-redirect"
      - "traefik.http.routers.lazylibrarian-redirect.rule=Host(`lazylibrarian.server.unarmedpuppy.com`)"
      - "traefik.http.routers.lazylibrarian-redirect.entrypoints=web"
      # Local network access (no auth) - highest priority
      - "traefik.http.routers.lazylibrarian-local.rule=Host(`lazylibrarian.server.unarmedpuppy.com`) && ClientIP(`192.168.86.0/24`)"
      - "traefik.http.routers.lazylibrarian-local.priority=100"
      - "traefik.http.routers.lazylibrarian-local.entrypoints=websecure"
      - "traefik.http.routers.lazylibrarian-local.tls.certresolver=myresolver"
      # External access (requires auth) - lowest priority
      - "traefik.http.routers.lazylibrarian.rule=Host(`lazylibrarian.server.unarmedpuppy.com`)"
      - "traefik.http.routers.lazylibrarian.priority=1"
      - "traefik.http.routers.lazylibrarian.entrypoints=websecure"
      - "traefik.http.routers.lazylibrarian.tls.certresolver=myresolver"
      - "traefik.http.routers.lazylibrarian.tls=true"
      - "traefik.http.routers.lazylibrarian.middlewares=lazylibrarian-auth"
      # Service and auth middleware
      - "traefik.http.services.lazylibrarian.loadbalancer.server.port=5299"
      - "traefik.http.middlewares.lazylibrarian-auth.basicauth.users=unarmedpuppy:$$apr1$$yE.A6vVX$$p7.fpGKw5Unp0UW6H/2c.0"
      - "traefik.http.middlewares.lazylibrarian-auth.basicauth.realm=LazyLibrarian"
      # Homepage labels
      - "homepage.group=Media & Entertainment"
      - "homepage.name=LazyLibrarian"
      - "homepage.href=https://lazylibrarian.server.unarmedpuppy.com"
      - "homepage.icon=si-goodreads"
      - "homepage.description=Books automation"

  # Kavita - Self-contained ebook/manga reader (replaces Calibre + Calibre-Web)
  kavita:
    image: harbor.server.unarmedpuppy.com/docker-hub/jvmilazz0/kavita:latest
    container_name: media-download-kavita
    environment:
      - TZ=${TZ:-America/Chicago}
    volumes:
      - ./kavita/config:/kavita/config
      - ${MEDIA_PATH:-/jenquist-cloud/archive/entertainment-media}/books:/books
    ports:
      - "8084:5000"
    restart: unless-stopped
    networks:
      - media-download-network
      - my-network
    labels:
      - "traefik.enable=true"
      - "traefik.docker.network=my-network"
      # HTTPS redirect
      - "traefik.http.middlewares.kavita-redirect.redirectscheme.scheme=https"
      - "traefik.http.routers.kavita-redirect.middlewares=kavita-redirect"
      - "traefik.http.routers.kavita-redirect.rule=Host(`kavita.server.unarmedpuppy.com`)"
      - "traefik.http.routers.kavita-redirect.entrypoints=web"
      # Main router - no basic auth (Kavita has built-in auth)
      - "traefik.http.routers.kavita.rule=Host(`kavita.server.unarmedpuppy.com`)"
      - "traefik.http.routers.kavita.entrypoints=websecure"
      - "traefik.http.routers.kavita.tls.certresolver=myresolver"
      - "traefik.http.routers.kavita.tls=true"
      # Service definition
      - "traefik.http.services.kavita.loadbalancer.server.port=5000"
      # Homepage labels
      - "homepage.group=Media & Entertainment"
      - "homepage.name=Kavita"
      - "homepage.href=https://kavita.server.unarmedpuppy.com"
      - "homepage.icon=si-bookstack"
      - "homepage.description=Ebook and manga reader"

  # Usenet Downloader (Alternative)
  sabnzbd:
    # image: lscr.io/linuxserver/sabnzbd:latest
    image: harbor.server.unarmedpuppy.com/lscr/linuxserver/sabnzbd:latest
    container_name: media-download-sabnzbd
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=${TZ:-America/Chicago}
    volumes:
      - ./sabnzbd/config:/config
      - /jenquist-cloud/archive/media-downloads-temp/sabnzbd:/downloads
    networks:
      - media-download-network
      - my-network
    ports:
      - "8079:8080"
    restart: unless-stopped
    profiles:
      - alternative
    labels:
      - "traefik.enable=true"
      - "traefik.docker.network=my-network"
      # HTTPS redirect
      - "traefik.http.middlewares.sabnzbd-redirect.redirectscheme.scheme=https"
      - "traefik.http.routers.sabnzbd-redirect.middlewares=sabnzbd-redirect"
      - "traefik.http.routers.sabnzbd-redirect.rule=Host(`sabnzbd.server.unarmedpuppy.com`)"
      - "traefik.http.routers.sabnzbd-redirect.entrypoints=web"
      # Local network access (no auth) - highest priority
      - "traefik.http.routers.sabnzbd-local.rule=Host(`sabnzbd.server.unarmedpuppy.com`) && ClientIP(`192.168.86.0/24`)"
      - "traefik.http.routers.sabnzbd-local.priority=100"
      - "traefik.http.routers.sabnzbd-local.entrypoints=websecure"
      - "traefik.http.routers.sabnzbd-local.tls.certresolver=myresolver"
      # External access (requires auth) - lowest priority
      - "traefik.http.routers.sabnzbd.rule=Host(`sabnzbd.server.unarmedpuppy.com`)"
      - "traefik.http.routers.sabnzbd.priority=1"
      - "traefik.http.routers.sabnzbd.entrypoints=websecure"
      - "traefik.http.routers.sabnzbd.tls.certresolver=myresolver"
      - "traefik.http.routers.sabnzbd.tls=true"
      - "traefik.http.routers.sabnzbd.middlewares=sabnzbd-auth"
      # Service and auth middleware
      - "traefik.http.services.sabnzbd.loadbalancer.server.port=8080"
      - "traefik.http.middlewares.sabnzbd-auth.basicauth.users=unarmedpuppy:$$apr1$$yE.A6vVX$$p7.fpGKw5Unp0UW6H/2c.0"
      - "traefik.http.middlewares.sabnzbd-auth.basicauth.realm=SABnzbd"
      # Homepage labels
      - "homepage.group=Media & Entertainment"
      - "homepage.name=SABnzbd"
      - "homepage.href=https://sabnzbd.server.unarmedpuppy.com"
      - "homepage.icon=si-qbittorrent"
      - "homepage.description=Usenet download client"


  # ===== COBALT - YouTube/Music Downloader =====
  # Self-hosted media downloader that bypasses YouTube bot detection
  cobalt:
    image: harbor.server.unarmedpuppy.com/ghcr/imputnet/cobalt:11
    init: true
    read_only: true
    restart: unless-stopped
    container_name: cobalt
    ports:
      - "9000:9000"
    environment:
      - API_URL=https://cobalt.server.unarmedpuppy.com/
      - API_PORT=9000
      # Use local yt-session-generator for YouTube auth tokens
      - YOUTUBE_SESSION_SERVER=http://yt-session-generator:8080
    networks:
      - media-download-network
      - my-network
    depends_on:
      - yt-session-generator
    labels:
      - "traefik.enable=true"
      - "traefik.docker.network=my-network"
      # HTTPS redirect
      - "traefik.http.middlewares.cobalt-redirect.redirectscheme.scheme=https"
      - "traefik.http.routers.cobalt-redirect.middlewares=cobalt-redirect"
      - "traefik.http.routers.cobalt-redirect.rule=Host(`cobalt.server.unarmedpuppy.com`)"
      - "traefik.http.routers.cobalt-redirect.entrypoints=web"
      # Local network access (no auth) - highest priority
      - "traefik.http.routers.cobalt-local.rule=Host(`cobalt.server.unarmedpuppy.com`) && ClientIP(`192.168.86.0/24`)"
      - "traefik.http.routers.cobalt-local.priority=100"
      - "traefik.http.routers.cobalt-local.entrypoints=websecure"
      - "traefik.http.routers.cobalt-local.tls.certresolver=myresolver"
      # External access (requires auth) - lowest priority
      - "traefik.http.routers.cobalt.rule=Host(`cobalt.server.unarmedpuppy.com`)"
      - "traefik.http.routers.cobalt.priority=1"
      - "traefik.http.routers.cobalt.entrypoints=websecure"
      - "traefik.http.routers.cobalt.tls.certresolver=myresolver"
      - "traefik.http.routers.cobalt.tls=true"
      - "traefik.http.routers.cobalt.middlewares=cobalt-auth"
      # Service and auth middleware
      - "traefik.http.services.cobalt.loadbalancer.server.port=9000"
      - "traefik.http.middlewares.cobalt-auth.basicauth.users=unarmedpuppy:$$apr1$$yE.A6vVX$$p7.fpGKw5Unp0UW6H/2c.0"
      - "traefik.http.middlewares.cobalt-auth.basicauth.realm=Cobalt"
      # Homepage labels
      - "homepage.group=Media & Entertainment"
      - "homepage.name=Cobalt"
      - "homepage.href=https://cobalt.server.unarmedpuppy.com"
      - "homepage.icon=mdi-youtube"
      - "homepage.description=YouTube/Music downloader API"

  # YouTube Session Generator - provides poToken for YouTube authentication
  yt-session-generator:
    image: harbor.server.unarmedpuppy.com/ghcr/imputnet/yt-session-generator:webserver
    init: true
    restart: unless-stopped
    container_name: yt-session-generator
    networks:
      - media-download-network
    # Internal only - accessed by cobalt container

networks:
  media-download-network:
    driver: bridge
    # internal: true removed - UI containers need to be accessible from host
  my-network:
    external: true

