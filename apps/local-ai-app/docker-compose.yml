services:
  local-ai-app:
    image: python:3.11-slim
    container_name: local-ai-app
    restart: unless-stopped
    ports:
      - "8001:8000"
    environment:
      - WINDOWS_AI_HOST=${WINDOWS_AI_HOST:-172.27.192.1}  # Your Windows machine IP
      - WINDOWS_AI_PORT=${WINDOWS_AI_PORT:-8000}            # Manager port on Windows
      - TIMEOUT=${TIMEOUT:-300}                             # Request timeout in seconds
    volumes:
      - ./app:/app
      - ./app/static:/app/static
    working_dir: /app
    command: >
      bash -lc "pip install fastapi uvicorn httpx &&
                uvicorn main:app --host 0.0.0.0 --port 8000"
    networks:
      - my-network
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.local-ai.rule=Host(`local-ai.server.unarmedpuppy.com`)"
      - "traefik.http.routers.local-ai.entrypoints=websecure"
      - "traefik.http.routers.local-ai.tls.certresolver=myresolver"
      - "traefik.http.services.local-ai.loadbalancer.server.port=8000"

networks:
  my-network:
    external: true
