version: '3.5'
services:
  jellyfin-unlock:
    build:
      context: .
      dockerfile: Dockerfile.unlock
    container_name: jellyfin-unlock
    privileged: true
    environment:
      - ZFS_PATH=${ZFS_PATH}
      - UNLOCK_USER=${UNLOCK_USER:-admin}
      - UNLOCK_PASSWORD_HASH=${UNLOCK_PASSWORD_HASH}
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock:ro
      - ${ZFS_PATH}:${ZFS_PATH}:shared
      - ./unlock-ui.html:/app/unlock-ui.html:ro
      - /dev/zfs:/dev/zfs
      # Mount host's ZFS binaries (adjust path for your system)
      - /usr/sbin/zfs:/usr/sbin/zfs:ro
      - /usr/sbin/zpool:/usr/sbin/zpool:ro
      - /lib64/libzfs.so.6:/lib64/libzfs.so.6:ro
      - /lib64/libzpool.so.5:/lib64/libzpool.so.5:ro
      - /lib64/libnvpair.so.3:/lib64/libnvpair.so.3:ro
      - /lib64/libuutil.so.3:/lib64/libuutil.so.3:ro
      - /lib64/libzfs_core.so.3:/lib64/libzfs_core.so.3:ro
      - /lib64/libzutil.so.3:/lib64/libzutil.so.3:ro
    ports:
      - "8889:8888"
    restart: 'unless-stopped'
    networks:
      - my-network
    labels:
      - "homepage.group=Services"
      - "homepage.name=ZFS Authenticator"
      - "homepage.icon=si-redhat"
      - "homepage.href=http://192.168.86.47:8889"

networks:
  my-network:
    external: true

