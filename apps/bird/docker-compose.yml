x-enabled: true

services:
  bird:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: bird
    restart: "no"
    environment:
      - TZ=America/Chicago
      - AUTH_TOKEN=${AUTH_TOKEN}
      - CT0=${CT0}
      - BOOKMARK_LIMIT=${BOOKMARK_LIMIT:-50}
      - RUN_MODE=${RUN_MODE:-cron}
      - SLEEP_INTERVAL=${SLEEP_INTERVAL:-21600}
    volumes:
      - bird-data:/app/data
    networks:
      - my-network

  bird-api:
    build:
      context: .
      dockerfile: Dockerfile.api
    container_name: bird-api
    restart: unless-stopped
    environment:
      - TZ=America/Chicago
    volumes:
      - bird-data:/app/data
    networks:
      - my-network
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.bird-api.rule=Host(`bird.server.unarmedpuppy.com`)"
      - "traefik.http.routers.bird-api.entrypoints=websecure"
      - "traefik.http.routers.bird-api.tls.certresolver=myresolver"
      - "traefik.http.services.bird-api.loadbalancer.server.port=8000"
      - "homepage.group=AI & Machine Learning"
      - "homepage.name=Bird Viewer"
      - "homepage.icon=si-x"
      - "homepage.href=https://bird.server.unarmedpuppy.com"
      - "homepage.description=Twitter bookmark viewer API"

volumes:
  bird-data:

networks:
  my-network:
    external: true
