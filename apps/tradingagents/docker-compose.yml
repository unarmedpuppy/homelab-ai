services:
  tradingagents:
    build:
      context: .
      dockerfile: Dockerfile
    image: tradingagents:local
    environment:
      - OPENAI_API_KEY=${OPENAI_API_KEY}
      - ALPHA_VANTAGE_API_KEY=${ALPHA_VANTAGE_API_KEY}
      - TERM=xterm-256color
    working_dir: /workspace/TradingAgents
    volumes:
      - ./data:/workspace/TradingAgents/.cache
      - ./env/.env:/workspace/TradingAgents/.env:ro
    stdin_open: true
    tty: true
    profiles: ["cli"]

  tradingagents-batch:
    build:
      context: .
      dockerfile: Dockerfile
    image: tradingagents:local
    environment:
      - OPENAI_API_KEY=${OPENAI_API_KEY}
      - ALPHA_VANTAGE_API_KEY=${ALPHA_VANTAGE_API_KEY}
      - TICKER=${TICKER:-NVDA}
      - DATE=${DATE:-2024-05-10}
    working_dir: /workspace/TradingAgents
    command: >-
      python -c "from tradingagents.graph.trading_graph import TradingAgentsGraph; from tradingagents.default_config import DEFAULT_CONFIG; ta=TradingAgentsGraph(debug=True, config=DEFAULT_CONFIG.copy()); _, d = ta.propagate('${TICKER}', '${DATE}'); print(d)"
    profiles: ["batch"]

volumes: {}
